public class bulksmsgupshup {
    public List<ContractWrapperCls> ContractList {get;set;}
    public string gupshupUserID{ get;set;}
    public string gupshupPassword{ get;set;}
    public string sendTemplate {get;set;}
    public string sendTo {get;set;}
    public Boolean typeshow{get;set;}
    public String selectedtype{get;set;}
    public Boolean showContact{get;set;}
    public Boolean selectall{get;set;}
    public String schoolname{get;set;} 
    //public List<SelectOption> selectacc{get; set;}
    public Contact con {get;set;}
    public List<Contact> cns {get;set;}
    
    public bulksmsgupshup(ApexPages.StandardController controller){
        typeshow=false;
        con = new Contact();
        cns = new List<Contact>();
        //selectacc= new List<SelectOption>();
        try {
            ContractList= new List<ContractWrapperCls>();
            gupshupUserID='2000045203';
            gupshupPassword='universalgoogle';
            smsgupshupTemplate__c smsgupshupTemplate= [SELECT Name__c, Description__c FROM smsgupshupTemplate__c limit 1];
            sendTemplate=smsgupshupTemplate.Description__c;
            //sendTemplate='Dear Parent, The School will re-open on 123 instead of 123. Regular school timings will be followed 123';
            sendTo='';
            for(Contact c : [SELECT ID,Name,Phone,Type__c,school_Name__c From Contact]){
                ContractList.add(new ContractWrapperCls(c));
            }
        }catch (Exception ex)
        {
            System.debug(ex.getMessage());
        }
    }
    public List<SelectOption> getTypeOption()
    {
        Schema.DescribeFieldResult describeResult =Contact.Type__c.getDescribe();
        List<Schema.PicklistEntry> entries = describeResult.getPicklistValues();
        List<SelectOption> optionsToReturn = new List<SelectOption>();
        for (Schema.PicklistEntry pEntry : entries) {
            if (pEntry.isActive()) {
                optionsToReturn.add(new SelectOption(pEntry.getValue(), pEntry.getLabel()));
            }
        }
        return optionsToReturn;
     }   
    
    //****Chandresh***//
   
     public void show(){
         
        //selectedtype=con.Type__c;
        ContractList=new List<ContractWrapperCls>();
        System.debug('selectedtype----'+selectedtype);
        String qry='Select id,Name,Type__c,Phone,school_Name__c  from Contact';
        if(schoolname!=null && !string.isEmpty(schoolname))
        {
            if(!qry.contains('where'))
            {
                qry=qry+' where ';
            }
            String school='\'%' + String.escapeSingleQuotes(schoolname.trim()) + '%\'';
            qry=qry+'school_Name__c'+' Like'+school+' AND ';
        }
        if(selectedtype!=null && !string.isEmpty(selectedtype))
        {
            if(!qry.contains('where'))
            {
                qry=qry+' where ';
            }
            qry=qry+'Type__c =: '+'selectedtype'+' AND ';
        }
         if(qry.endswith(' AND ')) 
         {
            qry = qry.removeEnd('AND ');
         } 
         
         
        qry=qry;
        List<Contact> conlist=Database.query(qry);
        Integer x=conlist.size();
        if(x==0)
        {
            ApexPages.addmessage(new ApexPages.message(ApexPages.severity.FATAL,'No Records Found!!!'));
        }
        else
        {    
            For(Contact cn : Database.query(qry)){
        
            ContractWrapperCls cw=new ContractWrapperCls(cn);
            ContractList.add(cw);
        }
           // System.debug('******----'+contactlist);
        }       
       // return null;
         
         
    /*    For(Contact cn : Database.query(qry)){
        
            ContractWrapperCls cw=new ContractWrapperCls(cn);
            ContractList.add(cw);
        } */
		//showContact=true;
      System.debug('ContractList------'+ContractList.size());
    }
        
    //****Chandresh***// 
    
    public void SendBulkSMS(){
        try{   
            string BulkPhoneNo='';
             for(ContractWrapperCls ContractWrapper : ContractList){
                if(ContractWrapper.isSelected){                    
                    if(ContractWrapper.contactcls.Phone != '' &&  ContractWrapper.contactcls.Phone !=null){
                        BulkPhoneNo += ContractWrapper.contactcls.Phone + ',' ;                  
                    }                   
                }                
            }
            sendTo=BulkPhoneNo;
            string response= sendgupshupsms(); 
             apexpages.Message msg = new Apexpages.Message(ApexPages.Severity.INFO,response);
             apexpages.addmessage(msg);
            System.debug(response);
        }catch(Exception ex){
            System.debug(ex.getMessage());
            apexpages.Message msg = new Apexpages.Message(ApexPages.Severity.error,ex.getMessage());
            apexpages.addmessage(msg);
        }
    }
    public string sendgupshupsms(){
        try{
            
            string FinalMsg= EncodingUtil.urlEncode(sendTemplate, 'UTF-8');
            string endpoint='https://enterprise.smsgupshup.com/GatewayAPI/rest?method=SendMessage&send_to='+sendTo+'&msg='+FinalMsg+'&msg_type=TEXT&userid='+ gupshupUserID+'&auth_scheme=plain&password='+ gupshupPassword+'&v=1.1&format=text';
            String bodyContent='';
            HttpRequest req = new HttpRequest();
            Http httpreq = new Http();
            req.setHeader('cache-control', 'no-cache');
            req.setBody(bodyContent);
            req.setEndpoint(endpoint);
            req.setMethod('POST');            
            HttpResponse res = httpreq.send(req);
            String reqresponse = res.getBody();
            return reqresponse;

        }catch (Exception ex){
            System.debug(ex.getMessage());
            return  '';
        }
    }
      public List<SelectOption> getsmsTemplates() {
        List<SelectOption> smsTemplates = new List<SelectOption>();
        try{
            for(smsgupshupTemplate__c sms :[SELECT Name__c,Description__c FROM smsgupshupTemplate__c ]){
                smsTemplates.add(new selectoption(sms.Description__c,sms.Name__c));
            }
        }catch (Exception ex)
        {
            System.debug(ex.getMessage());
        }
        return smsTemplates;

    }
    
    
    public static void testmethod1(){
           for(integer i=1; i<=1500; i++){
            i++;
            i++;
            i++;
            i++;
            i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;
i++;
            i++;
            i++;
            i++;

        }
    }

    
    
    
    
}